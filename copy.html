<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Copiar cor</title>
  <style>
    :root { --fg:#111827; --muted:#6b7280; --bd:#e5e7eb; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
           display:grid; place-items:center; height:100vh; margin:0; color:var(--fg); }
    .card { padding:24px; border:1px solid var(--bd); border-radius:14px; text-align:center; width:min(92vw, 460px); }
    .swatch { width:84px; height:84px; border-radius:12px; border:1px solid var(--bd); margin:16px auto; }
    .muted { color:var(--muted); font-size:14px; margin-top:8px; word-break:break-all; }
    button { padding:10px 16px; border-radius:10px; border:1px solid #111827; background:#111827; color:#fff; cursor:pointer; }
    a { color:inherit; }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="title">Copiando…</h1>
    <div id="swatch" class="swatch"></div>
    <p id="hex" class="muted"></p>
    <p id="status" class="muted">Se não copiar sozinho, toque no botão.</p>
    <button id="btn" style="display:none">Copiar manualmente</button>
    <p class="muted"><a id="back" href="javascript:history.back()">Voltar</a></p>
  </div>

  <script>
    async function getHexFromQuery() {
      const params = new URLSearchParams(location.search);
      const fromV = params.get("v");
      const fromName = params.get("name");
      if (fromV) return decodeURIComponent(fromV);
      if (fromName) {
        try {
          const res = await fetch('tokens.json', {cache: 'no-store'});
          const tokens = await res.json();
          if (tokens[fromName]) return tokens[fromName];
        } catch (e) {}
      }
      return "#000000";
    }

    (async () => {
      const hex = await getHexFromQuery();
      const title = document.getElementById("title");
      const status = document.getElementById("status");
      const btn = document.getElementById("btn");
      const swatch = document.getElementById("swatch");
      const hexP = document.getElementById("hex");

      hexP.textContent = hex;
      swatch.style.background = hex;

      async function copyNow() {
        try {
          await navigator.clipboard.writeText(hex);
          title.textContent = "Copiado ✓";
          status.textContent = "Agora é só colar onde quiser.";
          btn.style.display = "none";
        } catch (e) {
          title.textContent = "Permita copiar";
          status.textContent = "Seu navegador bloqueou a cópia automática. Clique no botão abaixo.";
          btn.style.display = "inline-block";
        }
      }

      copyNow();
      btn.addEventListener("click", copyNow);
    })();
  </script>
</body>
</html>
